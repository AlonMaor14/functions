kind: remote
metadata:
  name: sentiment-analysis-serving
  hash: dda02ea73cbb7c3a5da21747b92e1fd84c8bc60b
  project: default
  labels:
    author: roye
    framework: pytorch
  categories:
  - serving
  - NLP
  - BERT
  - sentiment analysis
spec:
  command: ''
  args: []
  image: mlrun/ml-models-gpu
  description: BERT based sentiment classification model
  min_replicas: 1
  max_replicas: 1
  env:
  - name: MODEL_CLASS
    value: SentimentClassifierServing
  config:
    spec.triggers.http:
      kind: http
      maxWorkers: 8
      attributes:
        ingresses: {}
      annotations: {}
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      name: sentiment-analysis-serving
      labels: {}
      annotations:
        nuclio.io/generated_by: function generated from bert_sentiment_analysis_serving.py
    spec:
      runtime: python:3.6
      handler: bert_sentiment_analysis_serving:handler
      env: []
      volumes: []
      build:
        commands: []
        noBaseImagesPull: true
        functionSourceCode: aW1wb3J0IG1scnVuCmltcG9ydCB0b3JjaAppbXBvcnQgdG9yY2gubm4gYXMgbm4KZnJvbSB0cmFuc2Zvcm1lcnMgaW1wb3J0IEJlcnRNb2RlbCwgQmVydFRva2VuaXplcgpmcm9tIGNsb3VkcGlja2xlIGltcG9ydCBkdW1wcwoKUFJFVFJBSU5FRF9NT0RFTCA9ICdiZXJ0LWJhc2UtY2FzZWQnCnRva2VuaXplciA9IEJlcnRUb2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKCdiZXJ0LWJhc2UtY2FzZWQnKQoKIyBiZWxvdyBpcyB0aGUgbW9kZWwgYXJjaGl0ZWN0dXJlLCBpbXBsZW1lbnRlZCB3aXRoIHB5dG9yY2ggd2hvc2UgbWFpbiBjb21wb25lbnQgaXMgYmVydC4KY2xhc3MgQmVydFNlbnRpbWVudENsYXNzaWZpZXIobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBuX2NsYXNzZXMpOgogICAgICAgIHN1cGVyKEJlcnRTZW50aW1lbnRDbGFzc2lmaWVyLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5iZXJ0ID0gQmVydE1vZGVsLmZyb21fcHJldHJhaW5lZChQUkVUUkFJTkVEX01PREVMKQogICAgICAgIHNlbGYuZHJvcG91dCA9IG5uLkRyb3BvdXQocD0wLjIpCiAgICAgICAgc2VsZi5vdXRfbGluZWFyID0gbm4uTGluZWFyKHNlbGYuYmVydC5jb25maWcuaGlkZGVuX3NpemUsIG5fY2xhc3NlcykKICAgICAgICBzZWxmLnNvZnRtYXggPSBubi5Tb2Z0bWF4KGRpbT0xKQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIGlucHV0X2lkcywgYXR0ZW50aW9uX21hc2spOgogICAgICAgIF8sIHBvb2xlZF9vdXQgPSBzZWxmLmJlcnQoCiAgICAgICAgICAgIGlucHV0X2lkcz1pbnB1dF9pZHMsCiAgICAgICAgICAgIGF0dGVudGlvbl9tYXNrPWF0dGVudGlvbl9tYXNrCiAgICAgICAgKQogICAgICAgIG91dCA9IHNlbGYuZHJvcG91dChwb29sZWRfb3V0KQogICAgICAgIG91dCA9IHNlbGYub3V0X2xpbmVhcihvdXQpCiAgICAgICAgcmV0dXJuIHNlbGYuc29mdG1heChvdXQpCgojIFRoZSBsb2FkIGZ1bmN0aW9uIGVzc2VudGlhbHkgaW5zdGFudGlhdGVzIG91ciBjdXN0b20gbW9kZWwgd2l0aCB0aGUgYXJjaGl0ZWN0dXJlIGRlZmluZWQgYWJvdmUuCmNsYXNzIFNlbnRpbWVudENsYXNzaWZpZXJTZXJ2aW5nKG1scnVuLnJ1bnRpbWVzLk1MTW9kZWxTZXJ2ZXIpOgogICAgZGVmIGxvYWQoc2VsZik6CiAgICAgICAgbW9kZWxfZmlsZSwgXyA9IHNlbGYuZ2V0X21vZGVsKCcucHQnKQogICAgICAgIGRldmljZSA9IHRvcmNoLmRldmljZSgnY3VkYTowJykgaWYgdG9yY2guY3VkYS5pc19hdmFpbGFibGUoKSBlbHNlIHRvcmNoLmRldmljZSgnY3B1JykKICAgICAgICBtb2RlbCA9IEJlcnRTZW50aW1lbnRDbGFzc2lmaWVyKG5fY2xhc3Nlcz0zKQogICAgICAgIG1vZGVsLmxvYWRfc3RhdGVfZGljdCh0b3JjaC5sb2FkKG1vZGVsX2ZpbGUsIG1hcF9sb2NhdGlvbj1kZXZpY2UpKQogICAgICAgIG1vZGVsLmV2YWwoKQogICAgICAgIHNlbGYubW9kZWwgPSBtb2RlbAogICAgZGVmIHByZWRpY3Qoc2VsZiwgYm9keSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbnN0YW5jZXMgPSBib2R5WydpbnN0YW5jZXMnXQogICAgICAgICAgICBlbmMgPSB0b2tlbml6ZXIuYmF0Y2hfZW5jb2RlX3BsdXMoaW5zdGFuY2VzLCByZXR1cm5fdGVuc29ycz0ncHQnLCBwYWRfdG9fbWF4X2xlbmd0aD1UcnVlKQogICAgICAgICAgICBvdXRwdXRzID0gc2VsZi5tb2RlbChpbnB1dF9pZHM9ZW5jWydpbnB1dF9pZHMnXSwgYXR0ZW50aW9uX21hc2s9ZW5jWydhdHRlbnRpb25fbWFzayddKQogICAgICAgICAgICBfLCBwcmVkcyA9IHRvcmNoLm1heChvdXRwdXRzLCBkaW09MSkKICAgICAgICAgICAgcmV0dXJuIHByZWRzLmNwdSgpLnRvbGlzdCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oIkZhaWxlZCB0byBwcmVkaWN0ICVzIiAlIGUpCmZyb20gbWxydW4ucnVudGltZXMgaW1wb3J0IG51Y2xpb19pbml0X2hvb2sKZGVmIGluaXRfY29udGV4dChjb250ZXh0KToKICAgIG51Y2xpb19pbml0X2hvb2soY29udGV4dCwgZ2xvYmFscygpLCAnc2VydmluZycpCgpkZWYgaGFuZGxlcihjb250ZXh0LCBldmVudCk6CiAgICByZXR1cm4gY29udGV4dC5tbHJ1bl9oYW5kbGVyKGNvbnRleHQsIGV2ZW50KQo=
  source: ''
  function_kind: serving
  build:
    commands: []
  readiness_timeout: 500
verbose: false
